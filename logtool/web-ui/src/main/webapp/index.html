<html>
<head>
    <title>GDLogTool</title>

    <link rel="stylesheet" type="text/css" href="extjs/resources/css/ext-all.css">
    <script type="text/javascript" src="extjs/ext-all.js"></script>
</head>
<body>
<P class="ext-standart">
    <script type="text/javascript">
        var selectedFilePath;
        var partViewed;
        var lineForPage = 30;

        var treeFromRoot;
        Ext.Ajax.request({
            url : '/logtool' ,
            params : { action : 'gettree' },
            method: 'GET',
            success: function (result, request) {
                var treeFromRoot = Ext.JSON.decode(result.responseText);

                var treestore = Ext.create('Ext.data.TreeStore', {
                    root: {
                        text: 'File System',
                        expanded: true,
                        children: treeFromRoot
                    }
                });

                var treePanel = new Ext.tree.TreePanel({
                    renderTo: 'div1',
                    title: 'Log File System',
                    rootVisible: false,
                    anchor: '100% 100%',
                    store: treestore,
                    listeners: {
                        itemclick: function(view, record, item, index, e) {
                            if (record.isLeaf()) {
                                selectedFilePath = record.get('text');
                                node = record.parentNode;
                                while (!node.isRoot()) {
                                    selectedFilePath = selectedFilePath + '/' + node.get('text');
                                    node = node.parentNode;
                                }
                                partViewed = -1;
                                writeText(selectedFilePath);

                            }
                        }

                    }
                });


            },
            failure: function (result, request) {
                Ext.MessageBox.alert('Failed', result.responseText);
            }

        });
        function writeText(pathToLog) {
            var prevViewed = partViewed;
            if (pathToLog == 'prev') {
                pathToLog = selectedFilePath;
                if (partViewed - lineForPage > lineForPage) {
                    partViewed = partViewed - lineForPage;
                } else {
                    partViewed = lineForPage;
                }
            }
            if (pathToLog == 'next') {
                pathToLog = selectedFilePath;
                partViewed = partViewed + lineForPage;
            }

                        Ext.Ajax.request({
                            url : '/logtool' ,
                            params : { action : 'getlog',path: pathToLog,partToView: partViewed, lines: lineForPage},
                            method: 'GET',
                            success: function (result, request) {
                                eval(result.responseText);
                                var countLogs = parseInt(response.total);
                                partViewed = parseInt(response.partViewed);
                                document.getElementById('div2').innerHTML =
                                        (' Page viewed ' + parseInt(partViewed / lineForPage) + ' from ' +
                                                parseInt(countLogs / lineForPage) + '<br>' + response.log);
                            },
                            failure: function (result, request) {
                                Ext.MessageBox.alert('Failed', result.responseText);
                            }

                        });

        }
        ;


    </script>


<table width="100%" style="height:100%;border-width:2px;" border="true">
    <tr style="height:50px;">
        <th>Structure</th>
        <th>View</th>
    </tr>
    <tr>
        <td width="20%">
            <div style="width:100%;height:100%;" id="div1"></div>
        </td>
        <td>
            <table width="100%" style="height:50px">
                <tr>
                    <td width="50%" align="left"><input type="button" value="Previous" onclick="writeText('prev')"/>
                    </td>
                    <td width="50%" align="right"><input type="button" value="Next" onclick="writeText('next')"/></td>
                </tr>
            </table>
            <div style="width:100%;height:100%;" id="div2"></div>
        </td>
    </tr>
</table>


</body>
</html>